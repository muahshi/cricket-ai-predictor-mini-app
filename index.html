<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Cricket Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font and Dark Theme Styling -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0b111e; /* Deep Dark Blue */
        }
        .cricket-card {
            background-color: #1a2230; /* Slightly lighter card background */
        }
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0b111e; }
        ::-webkit-scrollbar-thumb { background: #1f3f3f; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #2c5c5c; }
    </style>
</head>
<body class="min-h-screen bg-[#0b111e] text-gray-100 p-4 pt-8">

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Main App Container -->
    <div id="app-container" class="max-w-xl mx-auto">
        <h1 class="text-3xl font-extrabold text-cyan-400 mb-1 tracking-wider text-center">AI Cricket Predictor üèè</h1>
        <p class="text-sm text-gray-400 mb-6 text-center">Live Analysis | Betting Insights</p>

        <!-- Auth Status & User ID -->
        <div id="auth-status" class="cricket-card p-3 rounded-xl shadow-lg mb-6 text-xs break-all border border-gray-700">
            <span class="font-semibold text-cyan-500">Status:</span> <span id="auth-message">Initializing...</span>
            <br>
            <span class="font-semibold text-cyan-500">User ID:</span> <span id="user-id">Loading...</span>
        </div>

        <!-- Status Message Area -->
        <div id="status-display" class="p-3 mb-6 hidden rounded-xl text-sm transition-all duration-300 shadow-md"></div>

        <!-- Tier 1: Match Listing -->
        <h2 class="text-xl font-bold text-white mb-4 border-l-4 border-cyan-400 pl-2">Aaj Ke Major Fixtures</h2>
        <div id="match-list-container" class="space-y-3 mb-8">
            <p id="match-list-loading" class="text-gray-400 text-center">Loading matches...</p>
        </div>

        <!-- Search Form -->
        <form id="prediction-form" class="mb-8">
            <div class="flex flex-col sm:flex-row gap-3">
                <input type="text" id="match-query" placeholder="Match ka naam daalen (e.g., IND vs AUS T20)"
                       class="flex-grow bg-[#1a2230] text-white p-3 rounded-xl border border-gray-600 focus:ring-cyan-500 focus:border-cyan-500 transition duration-150 shadow-inner">
                <button type="submit" id="predict-button"
                        class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition duration-150 active:scale-95 disabled:bg-gray-500 disabled:shadow-none">
                    Predict Karo
                </button>
            </div>
        </form>

        <!-- Tier 2: Prediction Report Area (The Cricket Dashboard) -->
        <div id="prediction-report-container" class="mt-8 border-t-2 border-gray-700/50 pt-6">
            <h2 id="report-title" class="text-2xl font-bold text-white mb-6 border-l-4 border-green-500 pl-2 hidden">üìä AI Report Dashboard</h2>
            <div id="prediction-report" class="space-y-6">
                <!-- Report content will be rendered here -->
            </div>
        </div>

    </div>

    <!-- Premium Modal (Hidden by default) -->
    <div id="premium-modal" class="fixed inset-0 z-50 bg-black bg-opacity-90 hidden items-center justify-center p-4 transition-opacity duration-300">
        <div class="cricket-card rounded-2xl shadow-2xl p-6 w-full max-w-sm border-t-4 border-red-600 transform scale-100">
            <h3 class="text-2xl font-bold text-red-500 mb-3 flex items-center">üõë Limit Crossed!</h3>
            <p class="text-gray-300 mb-5">Aapka free analysis count poora ho chuka hai. Detailed betting report access karne ke liye, premium service unlock karein.</p>

            <div class="bg-[#0b111e] p-4 rounded-xl mb-5 border border-gray-700">
                <p class="text-sm font-semibold text-gray-400 mb-2">UPI Payment ID (Copy & Pay):</p>
                <div class="flex items-center justify-between">
                    <span id="upi-id-display" class="text-lg font-mono text-green-400 break-all">muahshi7759@ybl</span>
                    <button id="copy-upi-btn" class="ml-3 p-2 bg-green-600 rounded-lg hover:bg-green-700 active:scale-95 transition shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor"><path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" /><path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" /></svg>
                    </button>
                </div>
            </div>

            <button onclick="handlePaymentConfirmation()" class="w-full bg-green-500 hover:bg-green-600 text-[#0b111e] font-extrabold py-3 rounded-xl shadow-lg active:scale-95 transition duration-150">
                ‚úîÔ∏è I Have Paid
            </button>
            <button onclick="hidePremiumModal()" class="w-full mt-3 text-gray-400 hover:text-white py-2 transition duration-150 text-sm">
                Cancel
            </button>
        </div>
    </div>

    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Variables
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const apiKey = ""; // API Key is automatically handled by the environment
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        let app, db, auth;
        let userId = 'loading';
        let userStats = { freeCount: 0, isPremium: false }; // State management for monetization

        // --- Utility Functions ---

        /** Display status messages in the UI. */
        const showStatus = (message, type = 'info') => {
            const statusDisplay = document.getElementById('status-display');
            let bgColor, textColor, icon;

            switch (type) {
                case 'error':
                    bgColor = 'bg-red-900/40 border border-red-700';
                    textColor = 'text-red-300';
                    icon = '‚ö†Ô∏è';
                    break;
                case 'success':
                    bgColor = 'bg-green-900/40 border border-green-700';
                    textColor = 'text-green-300';
                    icon = '‚úÖ';
                    break;
                default: // info
                    bgColor = 'bg-cyan-900/40 border border-cyan-700';
                    textColor = 'text-cyan-300';
                    icon = '‚ÑπÔ∏è';
            }

            statusDisplay.className = `p-3 mb-6 rounded-xl text-sm transition-all duration-300 ${bgColor} ${textColor}`;
            statusDisplay.innerHTML = `<span class="font-bold">${icon} ${type.toUpperCase()}:</span> ${message}`;
            statusDisplay.style.display = 'block';
        };

        /** Hide status message. */
        const hideStatus = () => {
            document.getElementById('status-display').style.display = 'none';
        };

        /** Exponential Backoff retry mechanism for API calls. */
        const fetchWithRetry = async (url, payload, maxRetries = 5) => {
            const fetchOptions = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            for (let attempt = 1; attempt <= maxRetries; attempt++) {
                try {
                    showStatus(`AI analysis shuru: Attempt ${attempt} of ${maxRetries}...`, 'info');
                    const response = await fetch(url, fetchOptions);

                    if (response.ok) {
                        return await response.json();
                    }

                    // Handle specific errors for retry
                    if (response.status === 429 || response.status === 401) {
                        const errorMsg = response.status === 401 ? '401 Unauthorized: Key issue. Retrying...' : '429 Rate Limit: Waiting for backoff...';
                        showStatus(`Error ${response.status}: ${errorMsg}`, 'error');

                        if (attempt === maxRetries) throw new Error(`API failed after ${maxRetries} attempts with status ${response.status}`);

                        const delay = Math.pow(2, attempt) * 1000 + (Math.random() * 1000); // 2s, 4s, 8s...
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }

                    // For other non-retryable errors
                    const errorData = await response.json().catch(() => ({ message: response.statusText }));
                    throw new Error(`API request failed with status ${response.status}: ${errorData.message}`);

                } catch (error) {
                    if (attempt === maxRetries) throw error;
                    // If error is not API related but network or parsing, retry logic continues
                }
            }
        };

        // --- Firebase Setup and Authentication ---

        const setupFirebaseAndAuth = async () => {
            if (!firebaseConfig) {
                showStatus("Firebase Config nahi mila. App initialize nahi ho sakti.", 'error');
                return;
            }

            try {
                // Initialize Firebase Services
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Sign In Logic
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                    document.getElementById('auth-message').textContent = 'Authenticated (Custom)';
                } else {
                    await signInAnonymously(auth);
                    document.getElementById('auth-message').textContent = 'Authenticated (Anonymous)';
                }

                // Set up Auth State Listener
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                    } else {
                        userId = crypto.randomUUID();
                    }
                    document.getElementById('user-id').textContent = userId;
                    console.log(`User ID set: ${userId}`);

                    if (db) {
                        setupStatsListener(userId);
                    }
                });

            } catch (error) {
                console.error("Firebase setup ya login mein error:", error);
                showStatus(`Login failed: ${error.message}. Anonymous sign-in try karein.`, 'error');
                userId = crypto.randomUUID();
                document.getElementById('user-id').textContent = userId;
                document.getElementById('auth-message').textContent = 'Login Failed';
            }
        };

        // --- Firestore State Management (Monetization) ---

        const setupStatsListener = (currentUserId) => {
            const statsRef = doc(db, `/artifacts/${appId}/users/${currentUserId}/stats`, 'user_stats');

            // 1. Check if the document exists, if not, create it
            const initializeStats = async () => {
                const initialData = { freeCount: 0, isPremium: false };
                try {
                    await setDoc(statsRef, initialData, { merge: true });
                } catch (e) {
                    console.error("Error setting initial document:", e);
                }
            };
            initializeStats();

            // 2. Set up real-time listener
            onSnapshot(statsRef, (docSnap) => {
                if (docSnap.exists()) {
                    userStats = docSnap.data();
                    console.log("User Stats updated:", userStats);
                } else {
                    userStats = { freeCount: 0, isPremium: false };
                }
            }, (error) => {
                console.error("Firestore onSnapshot error:", error);
                showStatus("Error fetching user stats.", 'error');
            });
        };

        /** Increments freeCount in Firestore after a successful free prediction. */
        const incrementFreeCount = async () => {
            if (!db || userId === 'loading') return;
            const statsRef = doc(db, `/artifacts/${appId}/users/${userId}/stats`, 'user_stats');
            try {
                await updateDoc(statsRef, {
                    freeCount: userStats.freeCount + 1
                });
                showStatus(`Prediction successful! Free count updated to ${userStats.freeCount + 1}.`, 'success');
            } catch (error) {
                console.error("Error incrementing freeCount:", error);
                showStatus("Error updating usage count in Firebase.", 'error');
            }
        };

        // --- Monetization Modal Functions ---

        const showPremiumModal = () => {
            const modal = document.getElementById('premium-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            if (window.Telegram && window.Telegram.WebApp) {
                 window.Telegram.WebApp.HapticFeedback.notificationOccurred('warning');
            }
        };

        const hidePremiumModal = () => {
            const modal = document.getElementById('premium-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        };

        const copyUpiId = () => {
            const upiId = document.getElementById('upi-id-display').textContent;
            const textarea = document.createElement('textarea');
            textarea.value = upiId;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showStatus("UPI ID copy ho gaya: " + upiId, 'success');
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                }
            } catch (err) {
                showStatus("Copy nahi ho paya. Manual copy karein.", 'error');
            }
            document.body.removeChild(textarea);
        };

        const handlePaymentConfirmation = () => {
            hidePremiumModal();
            // Mocking premium access for demo
            showStatus("Payment confirmation request bhej diya hai. Access jald hi activate ho jayega. (Demo: Premium granted)", 'success');

            const statsRef = doc(db, `/artifacts/${appId}/users/${userId}/stats`, 'user_stats');
            updateDoc(statsRef, { isPremium: true })
                .catch(e => console.error("Error setting premium (Demo):", e));
        };
        document.getElementById('copy-upi-btn').addEventListener('click', copyUpiId);


        // --- Tier 1: Match Listing Logic ---

        const fetchFreeMatchList = async () => {
            const loadingText = document.getElementById('match-list-loading');
            loadingText.textContent = 'Loading today\'s major matches...';

            const userQuery = 'List of today\'s major cricket matches for prediction analysis';
            const systemPrompt = "Aap ek expert cricket match summarizer hain. Aaj ke major matches ke liye ek JSON array mein brief analysis dijiye. Output mein sirf JSON hona chahiye.";

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "ARRAY",
                        items: {
                            type: "OBJECT",
                            properties: {
                                "matchName": { "type": "STRING", "description": "e.g., India vs Pakistan, World Cup" },
                                "winningLikelihood": { "type": "STRING", "description": "e.g., Team A: 60%" },
                                "winnerTeam": { "type": "STRING" },
                                "teaserDetail": { "type": "STRING", "description": "1-line pitch/venue summary." }
                            },
                            "propertyOrdering": ["matchName", "winningLikelihood", "winnerTeam", "teaserDetail"]
                        }
                    }
                }
            };

            try {
                const result = await fetchWithRetry(apiUrl, payload);
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!jsonText) {
                    throw new Error("API se koi valid JSON response nahi mila.");
                }

                const matches = JSON.parse(jsonText);
                renderMatchList(matches);

            } catch (error) {
                console.error("Match list fetching mein error:", error);
                loadingText.textContent = `Error: ${error.message}. Please try a search below.`;
                showStatus("Match list fetch karne mein problem aayi.", 'error');
            }
        };

        const renderMatchList = (matches) => {
            const container = document.getElementById('match-list-container');
            container.innerHTML = '';
            document.getElementById('match-list-loading').style.display = 'none';

            if (matches.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center">Aaj koi major match nahi mila. Search box mein khud daal kar dekhein.</p>';
                return;
            }

            matches.forEach(match => {
                const matchCard = document.createElement('div');
                matchCard.className = 'match-card bg-[#1a2230] p-4 rounded-xl shadow-lg border-l-4 border-cyan-500 hover:bg-[#202836] transition duration-150 cursor-pointer active:scale-[0.99]';
                matchCard.innerHTML = `
                    <h3 class="text-lg font-bold text-white">${match.matchName}</h3>
                    <p class="text-xs text-gray-400 mt-1">${match.teaserDetail}</p>
                    <div class="flex justify-between items-center mt-3 pt-2 border-t border-gray-700">
                        <span class="text-sm font-semibold text-green-400">Winner: ${match.winnerTeam}</span>
                        <span class="text-xs text-cyan-400 bg-cyan-900/30 px-2 py-1 rounded-full">${match.winningLikelihood}</span>
                    </div>
                `;
                matchCard.addEventListener('click', () => {
                    document.getElementById('match-query').value = match.matchName;
                    document.getElementById('prediction-form').dispatchEvent(new Event('submit'));
                });
                container.appendChild(matchCard);
            });
        };


        // --- Tier 2: Detailed Prediction Logic ---

        const handlePrediction = async (event) => {
            event.preventDefault();
            const query = document.getElementById('match-query').value.trim();
            const predictButton = document.getElementById('predict-button');

            document.getElementById('prediction-report').innerHTML = '';
            document.getElementById('report-title').classList.add('hidden');
            hideStatus();

            if (!query) {
                showStatus("Kripya match ka naam daalen.", 'error');
                return;
            }

            // 1. Monetization Check
            if (!userStats.isPremium && userStats.freeCount >= 1) {
                showPremiumModal();
                return;
            }

            // Lock button and show loading
            predictButton.disabled = true;
            predictButton.textContent = 'Analyzing...';
            showStatus(`Analyzing "${query}"... Wait karein, yeh 10-15 seconds le sakta hai.`, 'info');

            try {
                // 2. AI Call with Detailed Schema
                const systemPrompt = "Aap ek world-class cricket betting analyst hain. Aapko live statistical analysis, team news, aur pitch conditions ke aadhar par ek detailed, structured betting prediction report deni hai. Sthir, accurate, aur betting-focused analysis dijiye. Output sirf JSON mein hona chahiye.";
                const userQuery = `Provide a detailed betting prediction report for the cricket match: ${query}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "MatchName": { "type": "STRING" },
                                "OverallWinner": { "type": "STRING" },
                                "WinningProbability": { "type": "STRING", "description": "e.g., '65% for Team A'" },
                                "PitchReport": { "type": "STRING", "description": "Detailed 2-3 line pitch analysis." },
                                "TossDecisionPrediction": { "type": "STRING", "description": "Recommended toss decision (Batting/Bowling) and reason." },
                                "FirstInningsScoreRange": { "type": "STRING", "description": "Predicted score range for the first innings (e.g., '160-180')." },
                                "KeyBattles": {
                                    "type": "ARRAY",
                                    "items": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "duel": { "type": "STRING", "description": "e.g., 'Virat Kohli vs Jasprit Bumrah'" },
                                            "analysis": { "type": "STRING", "description": "1-line analysis of this key battle." }
                                        }
                                    }
                                },
                                "TopPerformersLikely": {
                                    "type": "ARRAY",
                                    "items": { "type": "STRING", "description": "Player name." }
                                }
                            },
                            "propertyOrdering": ["MatchName", "OverallWinner", "WinningProbability", "PitchReport", "TossDecisionPrediction", "FirstInningsScoreRange", "KeyBattles", "TopPerformersLikely"]
                        }
                    }
                };

                const result = await fetchWithRetry(apiUrl, payload);
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!jsonText) {
                    throw new Error("AI se koi valid detailed report nahi mili.");
                }

                const report = JSON.parse(jsonText);
                renderPredictionReport(report);

                // 3. Update Monetization State (only if free)
                if (!userStats.isPremium) {
                    await incrementFreeCount();
                } else {
                    showStatus("Prediction successful! Premium access use kiya gaya.", 'success');
                }

            } catch (error) {
                console.error("Detailed prediction mein error:", error);
                showStatus(`Analysis mein error: ${error.message}`, 'error');
            } finally {
                // Unlock button
                predictButton.disabled = false;
                predictButton.textContent = 'Predict Karo';
            }
        };

        const renderPredictionReport = (report) => {
            const container = document.getElementById('prediction-report');
            document.getElementById('report-title').classList.remove('hidden');
            
            // Generate the visually appealing Cricket Dashboard
            container.innerHTML = `
                <!-- Dashboard Main Card (Scoreboard Style) -->
                <div class="cricket-card p-6 rounded-2xl shadow-2xl border-t-8 border-green-500/80">
                    
                    <!-- Match Title and Winning Team -->
                    <div class="text-center mb-6">
                        <p class="text-sm font-medium text-gray-400">Predicted Winner</p>
                        <h3 class="text-3xl font-black text-green-400 tracking-wide mt-1">${report.OverallWinner}</h3>
                        <p class="text-md text-cyan-400 bg-cyan-900/30 inline-block px-3 py-1 rounded-full mt-2">${report.WinningProbability}</p>
                    </div>

                    <div class="bg-[#0b111e] p-4 rounded-xl mb-6 shadow-inner border border-gray-700">
                        <p class="text-lg font-bold text-white">${report.MatchName}</p>
                    </div>

                    <!-- Key Metrics (Pitch, Toss, Score) - Grid Layout -->
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <!-- Pitch Report -->
                        <div class="bg-[#1a2230] p-3 rounded-lg border border-gray-700">
                            <p class="text-xs font-semibold text-gray-400 flex items-center mb-1">
                                üèüÔ∏è Pitch Report
                            </p>
                            <p class="text-sm text-gray-300 italic line-clamp-2" title="${report.PitchReport}">${report.PitchReport}</p>
                        </div>
                        
                        <!-- Toss Decision -->
                        <div class="bg-[#1a2230] p-3 rounded-lg border border-gray-700">
                            <p class="text-xs font-semibold text-gray-400 flex items-center mb-1">
                                ü™ô Toss Prediction
                            </p>
                            <p class="text-sm font-semibold text-yellow-400">${report.TossDecisionPrediction}</p>
                        </div>

                        <!-- First Innings Score Range -->
                        <div class="col-span-2 bg-[#1a2230] p-3 rounded-lg border border-yellow-700/50">
                            <p class="text-xs font-semibold text-gray-400 flex items-center mb-1">
                                üéØ First Innings Score Range
                            </p>
                            <p class="text-xl font-black text-yellow-500">${report.FirstInningsScoreRange}</p>
                        </div>
                    </div>

                    <!-- Top Performers -->
                    <div class="mt-6 border-t border-gray-700 pt-4">
                        <h4 class="text-lg font-bold text-white mb-3 flex items-center">‚≠ê Top Performers Likely:</h4>
                        <div class="flex flex-wrap gap-2 max-h-28 overflow-y-auto">
                            ${report.TopPerformersLikely.map(p => `<span class="bg-green-600/20 text-green-300 text-xs px-3 py-1 rounded-full shadow-md">${p}</span>`).join('')}
                        </div>
                    </div>
                </div> <!-- End of Dashboard Main Card -->

                <!-- Key Battles Section -->
                <div class="cricket-card p-5 rounded-2xl shadow-xl border-l-4 border-red-500">
                    <h4 class="text-lg font-bold text-white mb-4 flex items-center">‚öîÔ∏è Key Battles To Watch:</h4>
                    <div class="space-y-3">
                        ${report.KeyBattles.map(battle => `
                            <div class="bg-[#0b111e] p-3 rounded-lg border-b border-gray-700/50">
                                <p class="font-medium text-red-400">${battle.duel}</p>
                                <p class="text-xs text-gray-400 mt-1">${battle.analysis}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- CTA/Monetization Links -->
                <div class="flex flex-col gap-3 mt-6 pt-4 border-t border-gray-700">
                    <a href="https://your-betting-platform.com" target="_blank" class="w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg transition duration-150 active:scale-[0.98]">
                        üí∏ Betting Partner Link (Khelne ke liye Click Karein)
                    </a>
                    <a href="https://t.me/your_premium_group" target="_blank" class="w-full text-center bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 rounded-xl shadow-lg transition duration-150 active:scale-[0.98]">
                        üó£Ô∏è Premium Telegram Group Join Karein
                    </a>
                </div>
            `;
            // Scroll to the report to show it immediately
            document.getElementById('report-title').scrollIntoView({ behavior: 'smooth' });
        };


        // --- App Initialization ---

        document.addEventListener('DOMContentLoaded', () => {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                window.Telegram.WebApp.setHeaderColor('#0b111e');
                window.Telegram.WebApp.setBackgroundColor('#0b111e');
            }

            // Setup Firebase and Auth, then fetch initial data
            setupFirebaseAndAuth().then(() => {
                fetchFreeMatchList();
            });

            // Attach main prediction form submit listener
            document.getElementById('prediction-form').addEventListener('submit', handlePrediction);
        });

    </script>
</body>
</html>

